<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card mb-4">
        <% if @post.image.present? %>
          <%= image_tag @post.image.url, class: "card-img-top" %>
        <% end %>
        <div class="card-body">
          <h1 class="card-title"><%= @post.title %></h1>
          <p class="card-text"><%= @post.content %></p>
          <p class="text-muted">By <%= @post.author %></p>
          <% if @post.video.present? %>
            <video width="100%" controls class="mt-2">
              <source src="<%= @post.video.url %>" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          <% end %>
          <% if user_signed_in? && @post.user == current_user %>
            <%= link_to 'Edit', edit_post_path(@post), class: 'btn btn-primary mr-2' %>
            <%= button_to 'Delete', post_path(@post), method: :delete, class: 'btn btn-danger' %>
          <% end %>
        </div>
      </div>

      <div class="card mb-4">
        <div class="card-body">
          <% @post.comments.each do |comment| %>
            <div class="comment mb-3">
              <p><strong><%= comment.user.email %>:</strong> <%= comment.body %></p>
              <% if user_signed_in? && @post.user == current_user %>
                 <%= form_with(url: post_comment_path(@post, comment), method: :delete, data: { confirm: 'Are you sure?' }) do |form| %>
                  <%= form.submit 'Delete Comment', class: 'btn btn-danger btn-sm' %>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>

      <% if user_signed_in? %>
        <div class="card mb-4">
          <div class="card-body">
            <p><strong><%= current_user.email %>:</strong></p>
            <%= form_with(model: [@post, @post.comments.build], local: true) do |form| %>
              <div class="form-group">
                <%= form.label :body, "Comment", class: "control-label" %>
                <%= form.text_area :body, class: "form-control", rows: 3 %>
              </div>
              <%= form.submit 'Post Comment', class: "btn btn-primary" %>
            <% end %>
          </div>
        </div>
      <% else %>
        <p>You must be logged in to leave a comment.</p>
      <% end %>
    </div>
  </div>
</div>